<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Multi-Site Analysis for Independent Data Sources â€¢ patientfacts</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Multi-Site Analysis for Independent Data Sources">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">patientfacts</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="external-link nav-link" href="https://ssdqa.github.io/squba/">squba Home</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/multisite_independent.html">Multi-Site Analysis for Independent Data Sources</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://hdl.handle.net/20.500.14642/32">PEDSpace</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ssdqa/patientfacts/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Multi-Site Analysis for Independent Data Sources</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ssdqa/patientfacts/blob/main/vignettes/multisite_independent.Rmd" class="external-link"><code>vignettes/multisite_independent.Rmd</code></a></small>
      <div class="d-none name"><code>multisite_independent.Rmd</code></div>
    </div>

    
    
<p>The multi-site analyses included in this suite are intended to be
executed against data that are all stored in the same place. However,
there may be some instances where the data associated with each site is
stored in independent locations. This vignette outlines how the
multi-site analysis can be executed in these instances.</p>
<p>After following the instructions to reproduce the analysis, you will
also need to change the <code>output_function</code> column to tell the
<code>pf_output</code> function which check you executed. Reference the
table below for the labels that are associated with each check:</p>
<table class="table">
<thead><tr class="header">
<th align="left">Check Type</th>
<th align="left">output_function</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Multi Site, Exploratory, Cross-Sectional</td>
<td align="left">pf_ms_exp_cs</td>
</tr>
<tr class="even">
<td align="left">Multi Site, Exploratory, Longitudinal</td>
<td align="left">pf_ms_exp_la</td>
</tr>
<tr class="odd">
<td align="left">Multi Site, Anomaly Detection, Cross-Sectional</td>
<td align="left">pf_ms_anom_cs</td>
</tr>
<tr class="even">
<td align="left">Multi Site, Anomaly Detection, Longitudinal</td>
<td align="left">pf_ms_anom_la</td>
</tr>
</tbody>
</table>
<div class="section level2">
<h2 id="multi-site-exploratory-analysis">Multi-Site Exploratory Analysis<a class="anchor" aria-label="anchor" href="#multi-site-exploratory-analysis"></a>
</h2>
<div class="section level3">
<h3 id="cross-sectional">Cross-Sectional<a class="anchor" aria-label="anchor" href="#cross-sectional"></a>
</h3>
<p>First, execute the <strong>Single Site, Exploratory,
Cross-Sectional</strong> analysis, configured appropriately for your
study, against each data source.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ssdqa/patientfacts" class="external-link">patientfacts</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pf_process.html">pf_process</a></span><span class="op">(</span>cohort <span class="op">=</span> <span class="va">my_cohort</span>,</span>
<span>                       multi_or_single_site <span class="op">=</span> <span class="st">'single'</span>,</span>
<span>                       anomaly_or_exploratory <span class="op">=</span> <span class="st">'exploratory'</span>,</span>
<span>                       time <span class="op">=</span> <span class="cn">F</span>,</span>
<span>                       patient_level_tbl <span class="op">=</span> <span class="cn">T</span> <span class="op">/</span> <span class="cn">F</span>,</span>
<span>                       <span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p>The <code>median_all_*</code> columns will not reflect the overall
median using this method. This is typically used as a baseline
comparison metric in <code>pf_output</code>. If you do not mind the lack
of an overall comparison metric and would just like to compare
site-level medians, all you need to do is union each table together and
adjust the <code>output_function</code> accordingly.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>my_final_results <span class="ot">&lt;-</span> my_table1 <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">union</span>(my_table2) ... <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">union</span>(my_table_n) <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">output_function =</span> <span class="st">'pf_ms_exp_cs'</span>)</span></code></pre></div>
<p>If you would like to have the overall median available, you will need
to output patient-level results in addition to the standard summary
output (<code>patient_level_tbl = T</code>). Once patient-level output
is returned from each data source, you will need to union these tables
together and pass them through the functions below.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>my_combined_results <span class="ot">&lt;-</span> my_table1 <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">union</span>(my_table2) ... <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">union</span>(my_table_n) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">output_function =</span> <span class="st">'pf_ms_exp_cs'</span>)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>my_final_results <span class="ot">&lt;-</span> </span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  patientfacts<span class="sc">:::</span><span class="fu">compute_pf_medians</span>(<span class="at">data_input =</span> my_combined_results,</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>                                    <span class="at">site_col =</span> <span class="st">'site'</span>,</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>                                    <span class="at">agegrp =</span> age_groups <span class="co"># (as provided in pf_process)</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>                                    )</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="longitudinal">Longitudinal<a class="anchor" aria-label="anchor" href="#longitudinal"></a>
</h3>
<p>The Longitudinal analysis does not output any overall comparative
median, so for this check, just execute the <strong>Single Site,
Exploratory, Longitudinal</strong> check against each data source and
union the results together.</p>
<p>Outputting patient level results is not required, but this option is
still available for the longitudinal analysis if needed.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>my_table <span class="ot">&lt;-</span> <span class="fu">pf_process</span>(<span class="at">cohort =</span> my_cohort,</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>                       <span class="at">multi_or_single_site =</span> <span class="st">'single'</span>,</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>                       <span class="at">anomaly_or_exploratory =</span> <span class="st">'exploratory'</span>,</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>                       <span class="at">time =</span> T,</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>                       <span class="at">patient_level_tbl =</span> T <span class="sc">/</span> F,</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>                       ...)</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>my_final_results <span class="ot">&lt;-</span> my_table1 <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">union</span>(my_table2) ... <span class="sc">%&gt;%</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">union</span>(my_table_n) <span class="sc">%&gt;%</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">output_function =</span> <span class="st">'pf_ms_exp_la'</span>)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="multi-site-anomaly-detection-analysis">Multi-Site Anomaly Detection Analysis<a class="anchor" aria-label="anchor" href="#multi-site-anomaly-detection-analysis"></a>
</h2>
<div class="section level3">
<h3 id="cross-sectional-1">Cross-Sectional<a class="anchor" aria-label="anchor" href="#cross-sectional-1"></a>
</h3>
<p>Follow the instructions above for producing the
<code>Multi-Site, Exploratory, Cross-Sectional</code> output
<strong>with patient-level results</strong>. This is required for this
anomaly detection process as it is not possible to back-compute from the
standard aggregated results.</p>
<p>Once a combined table of patient-level results from each data source
has been created, execute the code below (using functions from the
<code>squba.gen</code> package) to run the anomaly detection analysis.
The <code>p_value</code> can be selected by the user.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_summary_table</span> <span class="op">&lt;-</span> <span class="va">my_combo_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">site</span>, <span class="va">visit_type</span>, <span class="va">domain</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>tot_pt <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">person_id</span><span class="op">)</span>, </span>
<span>            n_pt_fact <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">var_ever</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>prop_pt_fact <span class="op">=</span> <span class="va">n_pt_fact</span> <span class="op">/</span> <span class="va">tot_pt</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/squba.gen/man/compute_dist_anomalies.html" class="external-link">compute_dist_anomalies</a></span><span class="op">(</span>df_tbl <span class="op">=</span> <span class="va">my_summary_table</span>,</span>
<span>                                   grp_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'domain'</span>, <span class="st">'visit_type'</span><span class="op">)</span>,</span>
<span>                                   var_col <span class="op">=</span> <span class="st">'prop_pt_fact'</span>,</span>
<span>                                   denom_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'domain'</span>, <span class="st">'visit_type'</span>, </span>
<span>                                                  <span class="st">'tot_pt'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/squba.gen/man/detect_outliers.html" class="external-link">detect_outliers</a></span><span class="op">(</span>df_tbl <span class="op">=</span> <span class="va">df_start</span>,</span>
<span>                            tail_input <span class="op">=</span> <span class="st">'both'</span>,</span>
<span>                            p_input <span class="op">=</span> <span class="va">p_value</span>,</span>
<span>                            column_analysis <span class="op">=</span> <span class="st">'prop_pt_fact'</span>,</span>
<span>                            column_variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'domain'</span>, <span class="st">'visit_type'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="longitudinal-1">Longitudinal<a class="anchor" aria-label="anchor" href="#longitudinal-1"></a>
</h3>
<p>For a longitudinal analysis, start by following the instructions for
the <code>Multi-Site, Exploratory, Longitudinal</code> analysis. Then,
the <code>ms_anom_euclidean</code> function, available through the
<code>squba.gen</code> package, should be executed against your results.
Copy the code below, inputting the data you generated.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/squba.gen/man/ms_anom_euclidean.html" class="external-link">ms_anom_euclidean</a></span><span class="op">(</span>fot_input_tbl <span class="op">=</span> <span class="va">my_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                                <span class="fu">mutate</span><span class="op">(</span>prop_pts_fact <span class="op">=</span> <span class="va">pts_w_fact</span> <span class="op">/</span> <span class="va">pts_w_visit</span><span class="op">)</span>,</span>
<span>                              grp_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'site'</span>, <span class="st">'visit_type'</span>, <span class="st">'domain'</span><span class="op">)</span>,</span>
<span>                              var_col <span class="op">=</span> <span class="st">'prop_pts_fact'</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hanieh Razzaghi, Kaleigh Wieand, Kimberley Dickinson, Charles Bailey.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
